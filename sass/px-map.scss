/*
 * Copyright (c) 2018, General Electric
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

//
// Sass for the for the px-map component
//
// @author
//

// Settings
@import "px-colors-design/_settings.colors.scss";

// Tools
// ...

// Generic
@import "px-normalize-design/_generic.normalize.scss";
@import "px-box-sizing-design/_generic.box-sizing.scss";
@import "px-helpers-design/_generic.helpers.scss";

// Base
@import "px-typography-design/_base.typography.scss";
@import "px-flexbox-design/_base.flexbox.scss";
@import "px-viewport-design/_base.viewport.scss";

// Meta
@import "px-meta-buttons-design/_meta.buttons.scss";

// Objects
// ...

// Component

/*
 * Sass Variables and Style variables shared across sub-components
 */
$px-map-icon-unknown-color:                         var(--px-map-icon-unknown-color, gray);
$px-map-icon-info-color:                            var(--px-map-icon-info-color, blue);
$px-map-icon-warning-color:                         var(--px-map-icon-warning-color, orange);
$px-map-icon-important-color:                       var(--px-map-icon-important-color, red);
$px-map-icon-border-color:                          var(--px-map-icon-border-color, white);

$px-map-marker-group-cluster-path-size:             var(--px-map-marker-group-cluster-path-size, 10px);
$px-map-marker-group-cluster-font-size:             var(--px-map-marker-group-cluster-font-size, 15px);
$px-map-marker-group-cluster-font-color:            var(--px-map-marker-group-cluster-font-color, blue);
$px-map-marker-group-cluster-font-weight:           var(--px-map-marker-group-cluster-font-weight, normal);

$px-map-marker-group-cluster-font-color:            var(--px-map-marker-group-cluster-font-color, inherit);
$px-map-marker-group-cluster-font-size:             var(--px-map-marker-group-cluster-font-size, inherit);
$px-map-marker-group-cluster-font-weight:           var(--px-map-marker-group-cluster-font-weight, inherit);
$px-map-marker-group-cluster-line-height:           var(--px-map-marker-group-cluster-line-height, inherit);

$px-map-marker-group-cluster-border-size:           var(--px-map-marker-group-cluster-border-size, 5px);
$px-map-marker-group-cluster-border-color:          var(--px-map-marker-group-cluster-border-color, rgba(black,0.3));
$px-map-marker-group-cluster-polygon-stroke-color:  var(--px-map-marker-group-cluster-polygon-stroke-color, blue);
$px-map-marker-group-cluster-polygon-fill-color:    var(--px-map-marker-group-cluster-polygon-fill-color, blue);
$px-map-marker-group-cluster-background-color:      var(--px-map-marker-group-cluster-background-color, white);

$px-map-control-button-background-color:            var(--px-map-control-button-background-color, white);
$px-map-control-button-text-color:                  var(--px-map-control-button-text-color, blue);
$px-map-control-button-border-width:                var(--px-map-control-button-border-width, 3px);
$px-map-control-button-border-color:                var(--px-map-control-button-border-color, rgba(black,.3));
$px-map-control-button-background-color--hover:     var(--px-map-control-button-background-color--hover, gray);
$px-map-control-button-text-color--hover:           var(--px-map-control-button-text-color--hover, blue);

$px-map-control-button-border-color--disabled:      var(--px-map-control-button-border-color--disabled, gray);
$px-map-control-button-text-color--disabled:        var(--px-map-control-button-text-color--disabled, gray);

$px-map-info-control-background-color:              var(--px-map-info-control-background-color, white);
$px-map-info-control-border-color:                  var(--px-map-info-control-border-color, gray);

$px-map-data-box-border-color__top:                 var(--px-map-data-box-border-color__top, gray);
$px-map-data-box-border-color__left:                var(--px-map-data-box-border-color__left, gray);

$px-map-popup-content-wrapper-border:               var(--px-map-popup-content-wrapper-border, gray);

$px-map-marker-locate-icon-color:                   var(--px-map-marker-locate-icon-color, blue);
$px-map-marker-locate-icon-border-color:            var(--px-map-marker-locate-icon-border-color, white);
$px-map-marker-locate-icon-accuracy-color:          var(--px-map-marker-locate-icon-accuracy-color, black);
$px-map-marker-locate-icon-accuracy-opacity:        var(--px-map-marker-locate-icon-accuracy-opacity, 0.3);

/**
  * Internal css variables
  * We need internal css variables to be defined in :host so that we can
  * use them in the rest of the project. We could not put our external
  * variables in :host because :host has a higher specficy than :root.
  * This means the external variables would not be themable if they were
  * inside :host.
  *
  * The internal css variables are for the components who need to use
  * getComputedStyle in their js file. We also need these internal styles
  * for other scss files.
  */
:host {
  --internal-px-map-icon-unknown-color: $px-map-icon-unknown-color;
  --internal-px-map-icon-info-color: $px-map-icon-info-color;
  --internal-px-map-icon-warning-color: $px-map-icon-warning-color;
  --internal-px-map-icon-important-color: $px-map-icon-important-color;
  --internal-px-map-icon-border-color: $px-map-icon-border-color;

  --internal-px-map-marker-group-cluster-polygon-stroke-color: $px-map-marker-group-cluster-polygon-stroke-color;
  --internal-px-map-marker-group-cluster-polygon-fill-color: $px-map-marker-group-cluster-polygon-fill-color;
  --internal-px-map-marker-group-cluster-path-size: $px-map-marker-group-cluster-path-size;
  --internal-px-map-marker-group-cluster-border-size: $px-map-marker-group-cluster-border-size;

  --internal-px-map-marker-locate-icon-color: $px-map-marker-locate-icon-color;
  --internal-px-map-marker-locate-icon-border-color: $px-map-marker-locate-icon-border-color;
  --internal-px-map-marker-locate-icon-accuracy-color: $px-map-marker-locate-icon-accuracy-color;
  --internal-px-map-marker-locate-icon-accuracy-opacity: $px-map-marker-locate-icon-accuracy-opacity;

  --internal-px-map-popup-content-wrapper-border: $px-map-popup-content-wrapper-border;
}

/*
 * Override Leaflet's styles
 */
.leaflet-container {
  font-family: $predix-font-family;
  font-size: $inuit-base-font-size;
  line-height: $inuit-base-line-height;
}

/*******************************************************************************
 * ICONS (Attached to markers)
 ******************************************************************************/

// MAP ICON: BASE
@import "_map-icon.scss";

// MAP ICON: STATIC
@import "_map-icon-static.scss";

// MAP ICON: SYMBOL
@import "_map-icon-symbol.scss";

// MAP ICON: CUSTOM
@import "_map-icon-custom.scss";

// MAP ICON: CLUSTER
.map-icon-cluster {
  @extend %map-icon !optional;
  display: block;
  position: absolute;
}

.map-icon-cluster__container {
  border-radius: 100%;
  background: $px-map-marker-group-cluster-background-color;
  display: block;
  position: relative;
  box-sizing: border-box;
}
.map-icon-cluster__svg {
  display: block;
  position: absolute;
  width: 100%;
  height: 100%;
  border-radius: 100%;
  border-style: solid;
  border-width: $px-map-marker-group-cluster-border-size;
  border-color: $px-map-marker-group-cluster-border-color;
}
.map-icon-cluster__body {
  display: flex;
  width: 100%;
  height: 100%;
  align-items: center;
  justify-content: center;

  color: $px-map-marker-group-cluster-font-color;
  font-size: $px-map-marker-group-cluster-font-size;
  font-weight: $px-map-marker-group-cluster-font-weight;
  line-height: $px-map-marker-group-cluster-line-height;
}

.map-icon__highlight {
  --internal-px-map-icon-border-color: #45ACE5;
  --internal-px-map-icon-width: 50px;
  --internal-px-map-icon-height: 50px;
  --internal-px-map-icon-position-top: -10px;
  --internal-px-map-icon-position-left: -5px;
}

/*******************************************************************************
 * POPUPS
 ******************************************************************************/

// MAP POPUP: BASE
@import "_map-popup.scss";

// MAP POPUP: INFO
.map-popup-info {
  @extend %map-popup;

  .map-box-info {
    margin: $inuit-base-spacing-unit;
  }
}

// MAP POPUP: DATA
.map-popup-data {
  @extend %map-popup;

  .map-box-data {
    margin: $inuit-base-spacing-unit;
  }
}

/*******************************************************************************
 * CONTROLS
 ******************************************************************************/

// MAP CONTROL: BASE

// Generic styles for a round button
%map-control-button {
  background-color: $px-map-control-button-background-color;
  color: $px-map-control-button-text-color;
  border-style: solid;
  border-width: $px-map-control-button-border-width;
  border-color: $px-map-control-button-border-color;

  border-radius: 15%;
  line-height: calculateRem(18px);
  font-size: calculateRem(10px);
  font-weight: 400;
  width: calculateRem(30px);
  height: calculateRem(30px);

  margin-bottom: $inuit-base-spacing-unit--tiny;

  display: flex;
  align-items: center;
  justify-content: center;

  &:hover {
    background-color: $px-map-control-button-background-color--hover;
    color: $px-map-control-button-text-color--hover;
  }
}

// Extends generic button to be round
%map-control-button--round {
  width: calculateRem(30px);
  height: calculateRem(30px);
  position: relative;
  border-radius: 100%;
}

// MAP CONTROL: LOCATE: ;
.leaflet-bar.leaflet-control.leaflet-control-locate {
  border: none;
  border-radius: 0;
  box-shadow: none;
}
.leaflet-control.leaflet-control-locate {
  a.leaflet-control-locate-button {
    @extend %map-control-button;
    position: relative;
  }

  a.leaflet-control-locate-button {
    &.leaflet-control-locate-button--disabled {
      color: $px-map-control-button-text-color--disabled;
      cursor: not-allowed;
      pointer-events: none;
      border-color: $px-map-control-button-border-color--disabled;
    }
  }
}

// Locate followed by zoom OR zoom followed by locate should have a negative
// top margin that pulls the button groups toward eachother and makes spacing
// between buttons in both components look the same
.leaflet-control-locate + .leaflet-control-zoom,
.leaflet-control-zoom + .leaflet-control-locate {
  margin-top: $inuit-base-spacing-unit--tiny * -1;
}

// MAP CONTROL: ZOOM

.leaflet-bar.leaflet-control.leaflet-control-zoom {
  border: none;
  border-radius: 0;
  box-shadow: none;
}
.leaflet-bar.leaflet-control.leaflet-control-zoom {
  a.leaflet-control-zoom-in,
  a.leaflet-control-zoom-out {
    @extend %map-control-button;
    @extend %map-control-button--round;
    position: relative;
    border-radius: 100%;
  }
}

// MAP CONTROL: SCALE

// Set background and border style
.leaflet-control-scale-line {
  background: none;
  font-size: $inuit-base-font-size;
  border-width: 1px;
  border-color: $black;

  &:not(:first-child) {
    border-top: 1px solid $black;
    border-bottom: none;
    margin-top: -1px;
  }

  &:not(:first-child):not(:last-child) {
    border-bottom: 1px solid $black;
  }
}

// Set the styles for the `reverse` modifier (for dark backgrounds)
.leaflet-control-scale.leaflet-control-scale--reverse {
  background-color: rgba($black, 0.4);
  padding: 3px;
}
.leaflet-control-scale--reverse .leaflet-control-scale-line {
  color: $white;
  border-color: $white;

  &:not(:first-child) {
    border-top-color: $white;
  }

  &:not(:first-child):not(:last-child) {
    border-bottom-color: $white;
  }
}

// Set margins to be the same as other elements
.leaflet-left .leaflet-control-scale {
  margin-left: 10px;
}
.leaflet-bottom .leaflet-control-scale {
  margin-bottom: 10px;
}

// MAP CONTROL: INFO
.map-info-control {
  background-color: $px-map-info-control-background-color;
  max-width: 250px;
}
.map-info-control .map-box-info {
  margin: $inuit-base-spacing-unit;
}
.map-info-control .map-data-box {
  border: 1px solid $px-map-info-control-border-color;
}

/*******************************************************************************
 * GENERIC BOXES
 *
 * A `box` is a collection of information that can be placed into multiple
 * containers, like a `popup` or a `control`.
 ******************************************************************************/

 /* GENERIC: Info box generic styles, can be placed in multiple containers */
.map-box-info {
  @extend %clearfix;
}
// Style for the title, which is a text tag
.leaflet-popup-content {
  .map-box-info__title {
    font-weight: 600;
    margin: 0 0 $inuit-base-spacing-unit--tiny;
  }
  // Style for the description, which is a text tag
  .map-box-info__description {
    margin: 0;
  }
  // Style for the optional image, which is set to the left of the content
  .map-box-info__image {
    display: block;
    float: left;
    max-width: 75px;
    margin-right: $inuit-base-spacing-unit--small;
    img {
      max-width: 100%;
      height: auto;
    }
  }
  // We need the content container to be a block with overflow hidden to
  // inset the picture to the left without text wrapping.
  .map-box-info__content {
    display: block;
    overflow: hidden;
  }
}

/* GENERIC: Data box generic styles, can be placed in multiple containers */

.leaflet-popup-content {
  .map-data-box__header {
    padding: calculateRem(10px);
  }
  .map-data-box__header__text {
    text-transform: uppercase;
    font-size: calculateRem(12px);
    line-height: calculateRem(14px);
    margin: 0;
  }
  .map-data-box__table {
    display: flex;
    flex-wrap: wrap;
  }
  .map-data-box__table__cell {
    flex-grow: 1;
    overflow: hidden;
    width: 50%;

    border-top: 1px solid $px-map-data-box-border-color__top;
    &:nth-child(2n) { border-left: 1px solid $px-map-data-box-border-color__left;}

    padding: calculateRem(10px);
    text-transform: uppercase;
    font-size: calculateRem(12px);
    line-height: calculateRem(14px);
    p { margin: 0; }
  }
}

/*******************************************************************************
 * MARKER CLUSTER
 *
 * Styles the underlying pieces of marer-group's marker clusters that are not
 * styled through configuration in the component.
 ******************************************************************************/

// Handles animation of the clusters and spider legs
.leaflet-cluster-anim .leaflet-marker-icon, .leaflet-cluster-anim .leaflet-marker-shadow {
  transition: transform 0.3s ease-out, opacity 0.3s ease-in;
}
.leaflet-cluster-spider-leg {
  /* stroke-dashoffset (duration and function) should match with leaflet-marker-icon transform in order to track it exactly */
  transition: stroke-dashoffset 0.3s ease-out, stroke-opacity 0.3s ease-in;
}

// Trumps
@import "px-clearfix-design/_trumps.clearfix.scss";
@import "px-spacing-responsive-design/_trumps.spacing-responsive.scss";
@import "px-widths-responsive-design/_trumps.widths-responsive.scss";
